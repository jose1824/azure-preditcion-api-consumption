<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Ejercicio del miércoles</title>
</head>
<body>
    <h1 id="titulo" class="titulo-class">EJERCICIO DEL MIÉRCOLES</h1>
    <p id="instrucciones" style="border: 2px solid blue;">
        Ingresa la URL de una imagen de gatitos
    </p>

    <p>https://estaticos.muyinteresante.es/uploads/images/gallery/59c4f5655bafe82c692a7052/gato-marron-redes.jpg</p>

    <form id="MyForm">
        <input id="url" type="url" placeholder="URL de la imagen">
        <button type="button" onclick="sendToAzure2()">Enviar</button>
    </form>

    <!-- Aquí va a caer el resultado de la API -->
    <p id="result_space"></p>

</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script>

    function sendToAzure2() {
        const url = document.getElementById("url").value;
        console.log(url);
        $.ajax({
            url: "URL_DE_CUSTOM_VISION",
            beforeSend: function(xhrObj){
                // Request headers
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader("Prediction-key","PREDICTION_KEY");
            },
            type: "POST",
            // Request body
            data: '{"Url":"' + url + '"}',
        })
        .done(function(data) {
            var majorElement = "";
            var majorPrediction = 0;
            data.predictions.forEach(element => {
                if (majorPrediction < element.probability) {
                    majorPrediction = element.probability
                    majorElement = element.tagName
                }
                    
            });

            const prediction = round(majorPrediction * 100)
            console.log(majorPrediction)

            switch(majorElement) {
                case "gatos":
                    document.getElementById("result_space").innerHTML = "La foto es de un gato con una probabilidad de " + prediction + " %"
                    break
                case "perros":
                    document.getElementById("result_space").innerHTML = "La foto es de un perro con una probabilidad de " + prediction + "%"
                    break
                default:
                    document.getElementById("result_space").innerHTML = "No se que sea"
            }
        })
        .fail(function() {
            alert("error");
        });
    }

    function round(num, decimales = 2) {
        var signo = (num >= 0 ? 1 : -1);
        num = num * signo;
        if (decimales === 0) //con 0 decimales
            return signo * Math.round(num);
        // round(x * 10 ^ decimales)
        num = num.toString().split('e');
        num = Math.round(+(num[0] + 'e' + (num[1] ? (+num[1] + decimales) : decimales)));
        // x * 10 ^ (-decimales)
        num = num.toString().split('e');
        return signo * (num[0] + 'e' + (num[1] ? (+num[1] - decimales) : -decimales));
    }

</script>
